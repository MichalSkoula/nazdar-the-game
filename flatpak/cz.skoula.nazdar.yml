app-id: cz.skoula.nazdar
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.dotnet8
command: nazdar-launcher.sh
finish-args:
  - --socket=x11
  - --socket=wayland
  - --socket=pulseaudio
  - --share=ipc
  - --device=dri
  - --persist=.nazdar
build-options:
  append-path: /usr/lib/sdk/dotnet8/bin
  append-ld-library-path: /usr/lib/sdk/dotnet8/lib
  env:
    PKG_CONFIG_PATH: /app/lib/pkgconfig:/app/share/pkgconfig:/usr/lib/pkgconfig:/usr/share/pkgconfig:/usr/lib/sdk/dotnet8/lib/pkgconfig
modules:
  - name: nazdar-the-game
    buildsystem: simple
    build-commands:
      # Note: PublishSingleFile=false is intentional for Flatpak - the sandbox works better
      # with unpacked binaries, and Flatpak handles packaging/distribution anyway
      - dotnet publish Nazdar.GL/Nazdar.GL.csproj -c Release -r linux-x64 --self-contained
        -p:PublishSingleFile=false -p:PublishReadyToRun=false -p:TieredCompilation=false
        -o /app/bin/nazdar
      - install -Dm644 flatpak/cz.skoula.nazdar.desktop /app/share/applications/cz.skoula.nazdar.desktop
      - install -Dm644 flatpak/cz.skoula.nazdar.metainfo.xml /app/share/metainfo/cz.skoula.nazdar.metainfo.xml
      - install -Dm644 Nazdar.Android/Resources/Drawable/Icon.png /app/share/icons/hicolor/256x256/apps/cz.skoula.nazdar.png
      - |
        cat > /app/bin/nazdar-launcher.sh << 'EOF'
        #!/bin/sh
        cd /app/bin/nazdar
        exec ./Nazdar.GL "$@"
        EOF
      - chmod +x /app/bin/nazdar-launcher.sh
    sources:
      - type: dir
        path: ..
      - type: file
        path: cz.skoula.nazdar.desktop
      - type: file
        path: cz.skoula.nazdar.metainfo.xml
